{% extends "layout.html" %}

{% block body %}
<h1>Data &quot;<span class="dataset_meta">{{ dataset.get_name() }}</span>&quot; </h1>

<div class="row dataset_inspect_metadata">
    <div class="dataset_inspect_meta col-6">
        <span class="dataset_inspect_meta_label">Owner:</span> <span class="dataset_inspect_meta_value">{{ dataset.owner.get_name() }}</span><br />
        <span class="dataset_inspect_meta_label">Fields:</span> <span class="dataset_inspect_meta_value">{{ ", ".join(df.columns) }}</span>
    </div>
    <div class="dataset_inspect_meta col-6">
        <form action="{{ url_for("inspect_dataset", dsid=dataset.dataset_id) }}" method="get" id="form_doquery">
        <div class="form-group row">
            <div class="col-12">
                <div class="input-group">
                    <input id="query" name="query" placeholder="search" type="text" class="form-control" value="{{ query }}"> 
                    <div class="input-group-append">
                        <button class="btn btn-outline-primary input-group-text" onclick="return $('#form_doquery').submit();">
                            <i class="fa fa-arrow-circle-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div> 

        <div class="form-group row">
            <div class="col-12">
                <div class="custom-control custom-checkbox custom-control-inline">
                    {% if hideempty %}
                    <input name="hideempty" id="hideempty" type="hidden" value="true" />
                    <input name="cb_hideempty" id="cb_hideempty" type="checkbox" class="custom-control-input" value="true" checked="checked"> 
                    {% else %}
                    <input name="hideempty" id="hideempty" type="hidden" value="false" />
                    <input name="cb_hideempty" id="cb_hideempty" type="checkbox" class="custom-control-input" value="false"> 
                    {% endif %}
                    <label for="cb_hideempty" class="custom-control-label">Hide rows without annotations</label>
                </div>
            </div>
        </div> 
        </form>

    </div>
</div>

<div class="row">
    {{ render_dataframe(df, "dfid", "dfclasses", query=query) }}
</div>

{% endblock %}

{% block addscript %}
<script>
    /**
    * https://stackoverflow.com/questions/1090948/change-url-parameters
     * http://stackoverflow.com/a/10997390/11236
     */
    function updateURLParameter(url, param, paramVal) {
        let TheAnchor = null;
        let newAdditionalURL = "";
        let tempArray = url.split("?");
        let baseURL = tempArray[0];
        let additionalURL = tempArray[1];
        let temp = "";

        if (additionalURL) 
        {
            let tmpAnchor = additionalURL.split("#");
            let TheParams = tmpAnchor[0];
            TheAnchor = tmpAnchor[1];
            if(TheAnchor)
                additionalURL = TheParams;

            tempArray = additionalURL.split("&");

            for (let i=0; i<tempArray.length; i++)
            {
                if(tempArray[i].split('=')[0] != param)
                {
                    newAdditionalURL += temp + tempArray[i];
                    temp = "&";
                }
            }        
        }
        else
        {
            let tmpAnchor = baseURL.split("#");
            let TheParams = tmpAnchor[0];
            TheAnchor  = tmpAnchor[1];

            if(TheParams)
                baseURL = TheParams;
        }

        if(TheAnchor)
            paramVal += "#" + TheAnchor;

        let rows_txt = temp + "" + param + "=" + paramVal;
        return baseURL + "?" + newAdditionalURL + rows_txt;
    }

        const hideEmptyCB = document.getElementById("cb_hideempty");
        hideEmptyCB.addEventListener("click", function() {
            document.getElementById("hideempty").value = hideEmptyCB.checked;
            return $('#form_doquery').submit();
        });
    </script>
{% endblock %}
