{% extends "layout.html" %}
{% block body %}
<h1>Annotate &quot;<span class="annometa">{{ task.name }}</span>&quot; </h1>

{{ render_progress(task, addclass="annoprogress") }}

<div class="row">
<div id="anno_actions">
    {% if dataset.dsmetadata.size > 0 and sample_idx > 0 %}
    <a id="anno_nav_prev"class="btn btn-info btn-lg" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=sample_idx - 1) }}" title="previous sample">
        <i class="fas fa-2x fa-arrow-left"></i>
    </a>
{% endif %}
    {% if dataset.dsmetadata.size > 0 and sample_idx == 0 %}
    <a id="anno_nav_prev" class="btn btn-info btn-lg" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=dataset.dsmetadata.size - 1) }}" title="previous sample">
        <i class="fas fa-2x fa-arrow-left"></i>
    </a>
{% endif %}

{% for tag in dataset.dsmetadata.taglist %}
{% if dataset.dsmetadata.size > 0 and sample_idx < (dataset.dsmetadata.size - 1) %}
<a data-tagidx="{{loop.index - 1}}" class="btn {% if tag != curanno %}btn-light{% else %}btn-primary{% endif %}" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=sample_idx + 1, set_sample_idx=sample_idx, set_value=tag) }}">
{% endif %}
{% if dataset.dsmetadata.size > 0 and sample_idx == (dataset.dsmetadata.size - 1) %}
<a data-tagidx="{{loop.index - 1}}" class="btn {% if tag != curanno %}btn-light{% else %}btn-primary{% endif %}" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=0, set_sample_idx=sample_idx, set_value=tag) }}">
{% endif %}
{{ tag }}
</a>
{% else %}
ERROR: no taglist
{% endfor %}

{% if dataset.dsmetadata.size > 0 and sample_idx < (dataset.dsmetadata.size - 1) %}
<a id="anno_nav_next" class="btn btn-info btn-lg" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=sample_idx + 1) }}" title="next sample">
    <i class="fas fa-2x fa-arrow-right"></i>
</a>
{% endif %}
{% if dataset.dsmetadata.size > 0 and sample_idx == (dataset.dsmetadata.size - 1) %}
<a id="anno_nav_next" class="btn btn-info btn-lg" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=0) }}" title="next sample">
    <i class="fas fa-2x fa-arrow-right"></i>
</a>
{% endif %}

<a id="anno_nav_random" class="btn btn-info btn-lg" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=random_sample) }}" title="random sample">
    <i class="fas fa-2x fa-random"></i>
</a>

</div>
</div>

<br />
<div class="row">
<blockquote class="sampletext col-md-10 offset-md-1">
    {{sample_content}}
</blockquote>
</div>

<br />
<br />

{% endblock %}

{% block addscript %}
    <script>
        $(document).ready(function() {

            document.addEventListener("keydown", event => {
                if (event.isComposing || event.keyCode === 229) {
                    return;
                }
                console.log("kbd", event);
                let $tgtid = null;

                if (event.key === "ArrowRight") {
                    $tgtid = 'anno_nav_next';
                }
                if (event.key === "ArrowLeft") {
                    $tgtid = 'anno_nav_prev';
                }
                if (event.key === "R" || event.key === "r") {
                    $tgtid = 'anno_nav_random';
                }
                let $tgtbtn = null;
                if ($tgtid) {
                    $tgtbtn = $("#" + $tgtid);
                }
                if (event.keyCode > 48 && event.keyCode <= 57) {
                    let tagoffset = event.keyCode - 48 - 1;
                    let tagcount = {{ dataset.dsmetadata.taglist|length }};
                    if (tagoffset < tagcount) {
                        $("a.btn").each(function() {
                            let $this = $(this);
                            if ($this.data("tagidx") == tagoffset) {
                                $tgtbtn = $(this);
                            }
                        });
                    }
                }
                if ($tgtbtn && $tgtbtn[0]) { 
                    $($tgtbtn[0]).removeClass("btn-info");
                    $($tgtbtn[0]).removeClass("btn-primary");
                    $($tgtbtn[0]).removeClass("btn-light");
                    $($tgtbtn[0]).addClass("btn-dark");
                    $tgtbtn[0].click();
                }
            });

        });
    </script>
{% endblock %}
