{% extends "dataset_layout.html" %}
{% block page_title %}
Annotate &quot;<span class="annometa">{{ task.name }}</span>&quot; 
{% endblock %}

{% block pagebody %}

{{ macros.render_progress(task, addclass="annoprogress") }}

<div class="row">
<div id="anno_actions">

{% set nextsampleidx = sample_idx + 1 %}
{% if not next_sample_idx is none %}
    {% set nextsampleidx = next_sample_idx %}
{% endif %}

{% if dataset.dsmetadata.size > 0 and sample_idx == (dataset.dsmetadata.size - 1) %}
    {% set nextsampleidx = 0 %}
{% endif %}

{{ macros.render_tag_buttons(dataset, nextsampleidx, votes) }}
<pre>
TODO remove
current sample {{ sample_idx }}
prev sample {{ sample_prev }}
next sample {{ sample_next }}
random sample {{ random_sample }}
</pre>
    <div class="btn-group">
    {% if sample_prev %}
    <a id="anno_nav_prev"class="btn btn-info btn-lg" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=sample_prev) }}" title="previous sample">
        <i class="fas fa-2x fa-arrow-left"></i>
    </a>
    {% endif %}
    {% if sample_next %}
    <a id="anno_nav_next" class="btn btn-info btn-lg" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=sample_next) }}" title="next sample">
        <i class="fas fa-2x fa-arrow-right"></i>
    </a>
    {% endif %}

    {% if random_sample %}
    <a id="anno_nav_random" class="btn btn-info btn-lg" href="{{ url_for('annotate', dsid=dataset.dataset_id, sample_idx=random_sample) }}" title="random sample">
        <i class="fas fa-2x fa-random"></i>
    </a>
    {% endif %}
    </div>

</div>
</div>

<br />
<div class="row">
<blockquote class="sampletext col-12 col-md-10 offset-md-1">
    {{sample_content}}
</blockquote>
</div>

<br />
<br />

{% endblock %}

{% block addscript %}
    <script>
        $(document).ready(function() {

            document.addEventListener("keydown", event => {
                if (event.isComposing || event.keyCode === 229) {
                    return;
                }
                console.log("kbd", event);
                let $tgtid = null;

                if (event.key === "ArrowRight") {
                    $tgtid = 'anno_nav_next';
                }
                if (event.key === "ArrowLeft") {
                    $tgtid = 'anno_nav_prev';
                }
                if (event.key === "R" || event.key === "r") {
                    $tgtid = 'anno_nav_random';
                }
                let $tgtbtn = null;
                if ($tgtid) {
                    $tgtbtn = $("#" + $tgtid);
                }
                if (event.keyCode > 48 && event.keyCode <= 57) {
                    let tagoffset = event.keyCode - 48 - 1;
                    let tagcount = {{ dataset.get_taglist()|length }};
                    if (tagoffset < tagcount) {
                        $("a.btn").each(function() {
                            let $this = $(this);
                            if ($this.data("tagidx") == tagoffset) {
                                $tgtbtn = $(this);
                            }
                        });
                    }
                }
                if ($tgtbtn && $tgtbtn[0]) { 
                    $($tgtbtn[0]).removeClass("btn-info");
                    $($tgtbtn[0]).removeClass("btn-primary");
                    $($tgtbtn[0]).removeClass("btn-success");
                    $($tgtbtn[0]).removeClass("btn-light");
                    $($tgtbtn[0]).addClass("btn-dark tag_current_choice");

                    $tgtbtn[0].click();
                }
            });

        });
    </script>
{% endblock %}
